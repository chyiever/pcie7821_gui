"""
图表坐标和网格修正说明
Plot Coordinate and Grid Corrections

修改内容：
1. 修复相位数据频谱横轴单位显示问题
2. 将所有图表改为线性坐标
3. 加密网格线显示

详细修改：
"""

# ================================
# 1. 频谱横轴单位修正
# ================================

"""
问题：
- 相位数据功率谱和PSD的横轴单位应该是Hz，但显示的是kHz

原因分析：
- 相位数据采样率：scan_rate = 2000 Hz
- 奈奎斯特频率：1000 Hz
- pyqtgraph可能自动将>=1000的Hz转换为kHz显示

解决方案：
在setLabel时直接在标签文本中包含单位，避免pyqtgraph的自动单位转换：

修改前：
```python
self.plot_widget_2.setLabel('bottom', freq_label, units=freq_unit, ...)
```

修改后：
```python
# 相位数据
self.plot_widget_2.setLabel('bottom', 'Frequency (Hz)', ...)
# 原始数据
self.plot_widget_2.setLabel('bottom', 'Frequency (MHz)', ...)
```

结果：
- 相位数据频谱：横轴显示 "Frequency (Hz)"，数值范围0-1000
- 原始数据频谱：横轴显示 "Frequency (MHz)"，数值范围0-500
"""

# ================================
# 2. 线性坐标修改
# ================================

"""
修改内容：
将所有频谱图改为线性坐标显示

修改前：
```python
self.plot_widget_2.setLogMode(x=True, y=False)  # X轴对数
```

修改后：
```python
self.plot_widget_2.setLogMode(x=False, y=False)  # X轴和Y轴都是线性
```

影响：
- 所有功率谱和PSD图表都使用线性X轴
- 便于读取精确的频率数值
- 更直观的频率分布显示

同时删除了相关的对数刻度设置函数：
- _setup_log_ticks()函数已移除
- 所有对数坐标相关的代码已清理
"""

# ================================
# 3. 网格线加密
# ================================

"""
修改内容：
增加网格线密度，提高数据读取精度

修改前：
```python
pw.showGrid(x=True, y=True, alpha=0.3)  # 基本网格
```

修改后：
```python
pw.showGrid(x=True, y=True, alpha=0.6)  # 增加透明度，更明显
x_axis.setStyle(showValues=True, tickLength=5)  # 更密集的刻度
y_axis.setStyle(showValues=True, tickLength=5)
```

改进效果：
- 网格线透明度从0.3提高到0.6，更明显
- 刻度线长度设置为5像素，更清晰
- 启用更多刻度值显示
- 便于精确读取坐标数值
"""

# ================================
# 4. 代码优化
# ================================

"""
代码简化和清理：

1. 移除不必要的变量：
   - freq_unit, freq_label, y_unit_suffix等临时变量
   - 简化了频率单位处理逻辑

2. 直接指定标签文本：
   - 避免了pyqtgraph的自动单位转换
   - 确保单位显示的一致性

3. 统一坐标系设置：
   - 所有图表都使用线性坐标
   - 移除了对数坐标相关的复杂逻辑

4. 网格设置统一：
   - 三个图表使用相同的网格样式
   - 提高了视觉一致性
"""

# ================================
# 5. 预期效果
# ================================

"""
修改后的显示效果：

时域图 (Plot 1)：
- X轴：Sample（线性）
- Y轴：Amplitude（线性）
- 网格：密集，透明度0.6

频谱图 (Plot 2)：
- 相位数据：X轴 "Frequency (Hz)"，范围0-1000
- 原始数据：X轴 "Frequency (MHz)"，范围0-500
- Y轴：Power (dB) 或 PSD (dB/Hz) 或 PSD (dB/MHz)
- 坐标：全部线性
- 网格：密集，便于读数

监控图 (Plot 3)：
- X轴：Position（线性）
- Y轴：Amplitude（线性）
- 网格：密集，透明度0.6

用户体验改进：
- 单位显示更准确
- 网格更密集，便于精确读数
- 线性坐标更直观
- 所有文本使用Times New Roman字体
"""

# ================================
# 6. 测试建议
# ================================

"""
测试要点：

1. 相位数据频谱：
   - 检查横轴标签是否显示 "Frequency (Hz)"
   - 验证频率数值是否在0-1000范围内
   - 确认使用线性坐标

2. 原始数据频谱：
   - 检查横轴标签是否显示 "Frequency (MHz)"
   - 验证频率数值是否正确转换为MHz
   - 确认使用线性坐标

3. 网格显示：
   - 网格线是否更密集
   - 透明度是否合适（0.6）
   - 刻度线是否清晰

4. 整体外观：
   - 字体是否统一为Times New Roman
   - 三个图表样式是否一致
   - 坐标轴标签是否清晰
"""

if __name__ == "__main__":
    print("图表坐标和网格修正完成")
    print("主要改进：")
    print("1. 修复相位数据频谱单位显示（Hz而非kHz）")
    print("2. 所有图表改为线性坐标")
    print("3. 网格线加密，提高读数精度")