"""
Raw数据显示优化修改说明
Raw Data Display Optimization

修改目标：
1. 修改raw数据显示更新间隔为1秒
2. 时域波形图降采样10倍显示
3. 频域计算仍使用原始数据，每秒更新一次

修改详情：
"""

# ================================
# 1. 更新间隔控制 (1秒间隔)
# ================================

"""
在 main_window.py 的 _on_raw_data 函数中添加了时间控制：

```python
# 控制raw数据显示更新频率：每秒更新一次
current_time = time.time()
if (current_time - self._last_raw_display_time) >= 1.0:  # 1秒间隔
    # 只有当间隔超过1秒才更新显示
    self._update_raw_display(data, channel_num)
    self._last_raw_display_time = current_time
```

原来：每收到数据就更新显示（约0.5秒一次）
现在：每隔1秒更新一次显示，数据仍然正常接收和保存
"""

# ================================
# 2. 时域波形降采样 (10倍)
# ================================

"""
在 _update_raw_display 函数中对时域数据进行降采样：

```python
# 时域显示：10倍降采样
raw_frame_data = data[start:end]
downsampled_data = raw_frame_data[::10]  # 每10个点取1个
self.plot_curve_1[i].setData(downsampled_data)
```

原来：显示全部原始数据点（如20480个点）
现在：只显示1/10的数据点（如2048个点），提高绘图性能
降采样方法：简单间隔采样（每10个点取1个）
"""

# ================================
# 3. 频域计算保持原始精度
# ================================

"""
频域计算仍然使用完整的原始数据：

```python
# 频域计算：使用原始数据（无降采样）
if self.params.display.spectrum_enable and point_num <= len(data):
    sample_rate = 1e9 / self.params.upload.data_rate
    # 使用原始数据计算频谱
    self._update_spectrum(data[:point_num], sample_rate,
                         self.params.display.psd_enable, 'short')
```

原来：使用原始数据计算频谱
现在：仍使用原始数据计算频谱，但更新频率降低到1秒一次
目的：保持频谱分析的精度和准确性
"""

# ================================
# 4. 性能改进总结
# ================================

"""
改进前的问题：
- Raw数据每0.5秒更新一次，频繁刷新
- 时域图绘制大量数据点，影响GUI响应
- 频域计算频繁，增加CPU负荷

改进后的效果：
- 显示更新间隔延长到1秒，减少GUI刷新频率
- 时域显示数据量减少90%，提高绘图性能
- 频域计算频率降低，但保持精度
- 数据保存不受影响，仍保存完整原始数据

预期性能提升：
- GUI响应性提高（减少绘图负荷）
- CPU使用率降低（减少计算频率）
- 内存使用优化（减少显示缓存）
- 用户体验改善（更流畅的界面）
"""

# ================================
# 5. 代码修改位置总结
# ================================

"""
修改的文件：main_window.py

1. 添加成员变量（第66-70行）：
   - self._raw_data_count: Raw数据计数器
   - self._last_raw_display_time: 上次显示更新时间

2. 修改 _on_raw_data 函数（第942-972行）：
   - 添加1秒间隔控制
   - 添加调试日志

3. 修改 _update_raw_display 函数（第1059-1099行）：
   - 时域数据10倍降采样
   - 频域数据保持原始精度

4. 修改初始化代码（第831-835行）：
   - 重置新增的计数器

技术细节：
- 降采样方法：data[::10] (简单间隔采样)
- 时间控制：time.time() 系统时间差值判断
- 多通道支持：所有通道都应用相同的降采样策略
- 错误处理：保留原有的异常捕获机制
"""

# ================================
# 6. 使用建议
# ================================

"""
参数调整建议：
1. 如果需要更高的时域显示精度，可以调整降采样倍数：
   - data[::5]  # 5倍降采样
   - data[::20] # 20倍降采样

2. 如果需要更频繁的更新，可以调整更新间隔：
   - >= 0.5  # 0.5秒间隔
   - >= 2.0  # 2秒间隔

3. 可以根据数据率动态调整：
   - 高数据率时增大间隔和降采样倍数
   - 低数据率时减小间隔和降采样倍数

监控指标：
- 观察GUI响应性改善情况
- 监控CPU使用率变化
- 检查内存使用是否优化
- 确认频谱分析精度未受影响
"""

if __name__ == "__main__":
    print("Raw数据显示优化说明文档")
    print("请参考以上注释了解具体的修改内容和技术细节")