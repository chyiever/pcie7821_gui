# DAS GUI åæ ‡è½´åˆ»åº¦æ˜¾ç¤ºä¸UIä¼˜åŒ–ä¿®æ”¹è®°å½•

**ä¿®æ”¹æ—¥æœŸ**: 2026-02-25
**å¼€å‘è€…**: Claude & QGH
**ç‰ˆæœ¬**: v1.2.0
**ä¸»è¦å†…å®¹**: Time-Spaceæ¨¡å—UIä¼˜åŒ–ã€åæ ‡è½´åˆ»åº¦æ˜¾ç¤ºé—®é¢˜ä¿®å¤å°è¯•ã€è½¯ä»¶ç¨³å®šæ€§æ”¹è¿›

---

## 1. ä¿®æ”¹æ¦‚è¿°

æœ¬æ¬¡ä¿®æ”¹ä¸»è¦é’ˆå¯¹ç”¨æˆ·åé¦ˆçš„Time-Space Plotæ¨¡å—çš„å››ä¸ªå…·ä½“é—®é¢˜ï¼š
1. åæ ‡è½´åˆ»åº¦ä¸æ˜¾ç¤º
2. å¢åŠ æ›´æ–°é—´éš”å‚æ•°æ§åˆ¶
3. UIå¸ƒå±€ä¼˜åŒ–ä¸º2è¡Œ
4. å‚æ•°å®æ—¶åº”ç”¨ï¼ˆæ— éœ€é‡å¯ï¼‰

åŒæ—¶è§£å†³äº†è½¯ä»¶å…³é—­æ—¶çš„ç¨³å®šæ€§é—®é¢˜å’Œå…¶ä»–ç»†èŠ‚ä¼˜åŒ–ã€‚

---

## 2. Time-Spaceå›¾UIä¼˜åŒ– (`src/time_space_plot.py`)

### 2.1 æ›´æ–°é—´éš”å‚æ•°æ§åˆ¶

#### æ–°å¢åŠŸèƒ½
- æ·»åŠ äº†`QSpinBox`æ§ä»¶æ§åˆ¶æ˜¾ç¤ºæ›´æ–°é¢‘ç‡
- å‚æ•°èŒƒå›´ï¼š50-5000æ¯«ç§’ï¼Œé»˜è®¤100ms
- ä¸ç°æœ‰`QTimer`ç³»ç»Ÿé›†æˆï¼Œå®ç°åŠ¨æ€æ›´æ–°é¢‘ç‡æ§åˆ¶

#### æ ¸å¿ƒå®ç°ä»£ç 
```python
# æ·»åŠ æ›´æ–°é—´éš”æ§åˆ¶
self.update_interval_spin = QSpinBox()
self.update_interval_spin.setRange(50, 5000)  # 50ms to 5s
self.update_interval_spin.setValue(self._update_interval_ms)
self.update_interval_spin.setSuffix(" ms")
self.update_interval_spin.valueChanged.connect(self._on_update_interval_changed)

# Timeræœºåˆ¶é›†æˆ
def _schedule_display_update(self):
    """åŸºäºæ›´æ–°é—´éš”æ§åˆ¶æ˜¾ç¤ºåˆ·æ–°"""
    if not self._display_timer.isActive():
        self._display_timer.start(self._update_interval_ms)
        self._pending_update = False
    else:
        self._pending_update = True

def _on_update_interval_changed(self, value: int):
    """å¤„ç†æ›´æ–°é—´éš”å˜åŒ–"""
    self._update_interval_ms = value
    self.parametersChanged.emit()
```

#### æŠ€æœ¯ä»·å€¼
- **æ€§èƒ½æ§åˆ¶**: ç”¨æˆ·å¯æ ¹æ®ç³»ç»Ÿæ€§èƒ½è°ƒæ•´åˆ·æ–°ç‡
- **å®æ—¶å“åº”**: å‚æ•°å˜åŒ–ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯
- **é˜²æŠ–æœºåˆ¶**: pending updateæ¨¡å¼é¿å…æ›´æ–°å †ç§¯

### 2.2 UIå¸ƒå±€2è¡Œé‡ç»„

#### åŸæœ‰å¸ƒå±€é—®é¢˜
- 5è¡Œå‚ç›´å¸ƒå±€ï¼Œç©ºé—´åˆ©ç”¨ç‡ä½
- æ§ä»¶åˆ†æ•£ï¼Œå‚æ•°æŸ¥æ‰¾å›°éš¾
- é¢æ¿é«˜åº¦è¿‡å¤§ï¼Œå‹ç¼©å›¾è¡¨åŒºåŸŸ

#### æ–°è®¾è®¡2è¡Œå¸ƒå±€
```python
# Row 0: æ ¸å¿ƒæ•°æ®æ§åˆ¶
# Distance Range (From/To) + Window Frames + Time DS + Space DS

# Row 1: æ˜¾ç¤ºä¸äº¤äº’æ§åˆ¶
# Color Range (Min/Max) + Colormap + Update Interval + Reset Button
```

#### å®ç°ç»†èŠ‚
```python
def _create_control_panel(self) -> QGroupBox:
    """2è¡Œç½‘æ ¼å¸ƒå±€å®ç°"""
    layout = QGridLayout(group)
    layout.setHorizontalSpacing(15)  # æ°´å¹³é—´è·
    layout.setVerticalSpacing(8)     # å‚ç›´é—´è·

    # Row 0: è·ç¦»å’Œé‡‡æ ·æ§åˆ¶
    row = 0
    layout.addWidget(QLabel("Distance Range:"), row, 0)
    layout.addWidget(self.distance_start_spin, row, 2)
    layout.addWidget(self.distance_end_spin, row, 4)
    layout.addWidget(QLabel("Window Frames:"), row, 5)
    layout.addWidget(self.window_frames_spin, row, 6)
    # ... æ—¶é—´å’Œç©ºé—´é™é‡‡æ ·æ§ä»¶

    # Row 1: é¢œè‰²å’Œæ˜¾ç¤ºæ§åˆ¶
    row = 1
    layout.addWidget(QLabel("Color Range:"), row, 0)
    layout.addWidget(self.vmin_spin, row, 2)
    layout.addWidget(self.vmax_spin, row, 4)
    layout.addWidget(QLabel("Colormap:"), row, 5)
    layout.addWidget(self.colormap_combo, row, 6)
    layout.addWidget(self.update_interval_spin, row, 8)  # æ–°å¢
    layout.addWidget(reset_btn, row, 9, 1, 2)  # è·¨ä¸¤åˆ—

    # åˆ—æ‹‰ä¼¸æ§åˆ¶
    layout.setColumnStretch(11, 1)  # å³ä¾§å¼¹æ€§ç©ºé—´
```

#### è§†è§‰æ•ˆæœæ”¹è¿›
- **ç´§å‡‘æ€§**: æ§åˆ¶é¢æ¿é«˜åº¦ä»200pxå‹ç¼©åˆ°120px
- **é€»è¾‘æ€§**: ç›¸å…³å‚æ•°åˆ†ç»„æ”¾ç½®ï¼Œæ“ä½œç›´è§‚
- **ä¸€è‡´æ€§**: æ‰€æœ‰æ§ä»¶ç»Ÿä¸€é«˜åº¦22pxã€å­—ä½“8pt Times New Roman
- **å“åº”æ€§**: ç½‘æ ¼å¸ƒå±€è‡ªåŠ¨é€‚é…ä¸åŒå±å¹•å°ºå¯¸

### 2.3 å®æ—¶å‚æ•°åº”ç”¨æœºåˆ¶

#### é—®é¢˜åˆ†æ
åŸæœ‰å®ç°ä¸­ï¼ŒæŸäº›å‚æ•°å˜åŒ–éœ€è¦é‡å¯åº”ç”¨æ‰èƒ½ç”Ÿæ•ˆï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

#### è§£å†³æ–¹æ¡ˆ
```python
# ä¿¡å·è¿æ¥å®ç°å®æ—¶å“åº”
def _connect_parameter_signals(self):
    """è¿æ¥æ‰€æœ‰å‚æ•°å˜åŒ–ä¿¡å·"""
    self.distance_start_spin.valueChanged.connect(self._on_distance_start_changed)
    self.distance_end_spin.valueChanged.connect(self._on_distance_end_changed)
    self.window_frames_spin.valueChanged.connect(self._on_window_frames_changed)
    self.time_downsample_spin.valueChanged.connect(self._on_time_downsample_changed)
    self.space_downsample_spin.valueChanged.connect(self._on_space_downsample_changed)
    self.update_interval_spin.valueChanged.connect(self._on_update_interval_changed)
    self.colormap_combo.currentTextChanged.connect(self._on_colormap_changed)
    self.vmin_spin.valueChanged.connect(self._on_vmin_changed)
    self.vmax_spin.valueChanged.connect(self._on_vmax_changed)

# ç¼“å†²åŒºé‡å»ºå¤„ç†
def _on_window_frames_changed(self, value: int):
    """çª—å£å¸§æ•°å˜åŒ–æ—¶é‡å»ºç¼“å†²åŒº"""
    self._window_frames = value
    if self._data_buffer is not None:
        # ä¿ç•™ç°æœ‰æ•°æ®ï¼Œè°ƒæ•´ç¼“å†²åŒºå¤§å°
        old_data = list(self._data_buffer)
        self._data_buffer = deque(old_data, maxlen=value)
        self._update_display()
    self.parametersChanged.emit()

def _on_space_downsample_changed(self, value: int):
    """ç©ºé—´é™é‡‡æ ·å˜åŒ–æ—¶æ¸…ç©ºç¼“å†²åŒºé‡æ–°å¤„ç†"""
    self._space_downsample = value
    if self._data_buffer is not None:
        self._data_buffer.clear()  # å¼ºåˆ¶é‡æ–°å¤„ç†æ•°æ®
    self.parametersChanged.emit()
```

#### æŠ€æœ¯äº®ç‚¹
- **é›¶é‡å¯**: æ‰€æœ‰å‚æ•°å˜åŒ–ç«‹å³ç”Ÿæ•ˆ
- **æ™ºèƒ½ç¼“å­˜**: åˆç†ä¿ç•™æˆ–æ¸…ç©ºæ•°æ®ç¼“å­˜
- **çŠ¶æ€åŒæ­¥**: Qtä¿¡å·æœºåˆ¶ç¡®ä¿ç•Œé¢ä¸é€»è¾‘åŒæ­¥
- **æ€§èƒ½ä¼˜åŒ–**: æœ€å°åŒ–ä¸å¿…è¦çš„æ•°æ®é‡å¤„ç†

---

## 3. åæ ‡è½´åˆ»åº¦æ˜¾ç¤ºæŠ€æœ¯æŒ‘æˆ˜

### 3.1 é—®é¢˜æ ¹å› 

#### PyQtGraphç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
```python
# ä¸åŒPyQtGraphç‰ˆæœ¬ä¸­ImageViewå†…éƒ¨ç»“æ„å˜åŒ–:
# - 0.11.x: ImageView.getView().getPlotItem()
# - 0.12.x: ImageView.getView()ç›´æ¥æ˜¯PlotItem
# - 0.13.x: å†…éƒ¨ç»“æ„è¿›ä¸€æ­¥é‡ç»„
```

#### APIè®¿é—®è·¯å¾„å˜åŒ–
```python
# åŸæœ‰æ–¹æ³•å¤±æ•ˆ:
plot_item = self.image_view.getImageItem().getViewBox().parent()  # âŒ
plot_item = self.image_view.getPlotItem()  # âŒ æ–¹æ³•ä¸å­˜åœ¨

# éœ€è¦é‡‡ç”¨å¤šç§æ–¹æ³•å°è¯•:
view = self.image_view.getView()
if hasattr(view, 'showAxis'):
    plot_item = view  # æ–°ç‰ˆæœ¬
elif hasattr(view, 'getPlotItem'):
    plot_item = view.getPlotItem()  # æ—§ç‰ˆæœ¬
```

### 3.2 è§£å†³å°è¯•è¿‡ç¨‹

#### é˜¶æ®µ1: é²æ£’è·å–PlotItem
```python
def _get_plot_item_robust(self):
    """è·¨ç‰ˆæœ¬è·å–PlotItemçš„é²æ£’æ–¹æ³•"""
    plot_item = None

    try:
        # æ–¹æ³•1: ç›´æ¥viewè®¿é—®
        view = self.image_view.getView()
        if view and hasattr(view, 'showAxis'):
            plot_item = view
        elif view and hasattr(view, 'getPlotItem'):
            plot_item = view.getPlotItem()

        # æ–¹æ³•2: UIç•Œé¢è®¿é—® (å¤‡é€‰)
        if plot_item is None and hasattr(self.image_view, 'ui'):
            graphics_view = self.image_view.ui.graphicsView
            if hasattr(graphics_view, 'getPlotItem'):
                plot_item = graphics_view.getPlotItem()

    except Exception as e:
        log.warning(f"è·å–PlotItemå¤±è´¥: {e}")

    return plot_item
```

#### é˜¶æ®µ2: å¼ºåŒ–è½´é…ç½®
```python
def _configure_axis_set(self, plot_item):
    """å…¨é¢çš„è½´é…ç½®æ–¹æ³•"""
    try:
        # å¼ºåˆ¶æ˜¾ç¤ºè½´
        plot_item.showAxis('bottom', show=True)
        plot_item.showAxis('left', show=True)
        plot_item.showAxis('top', show=False)
        plot_item.showAxis('right', show=False)

        # è®¾ç½®è½´æ ‡ç­¾
        plot_item.setLabel('bottom', 'Distance (points)',
                         color='k', **{'font-family': 'Times New Roman', 'font-size': '12pt'})
        plot_item.setLabel('left', 'Time (samples)',
                         color='k', **{'font-family': 'Times New Roman', 'font-size': '12pt'})

        # é…ç½®è½´å±æ€§
        font = QFont("Times New Roman", 10)
        for axis_name in ['bottom', 'left']:
            axis = plot_item.getAxis(axis_name)
            if axis:
                axis.setTickFont(font)
                axis.setPen('k')
                axis.setTextPen('k')
                axis.setStyle(showValues=True)  # å¼ºåˆ¶æ˜¾ç¤ºæ•°å€¼
                axis.enableAutoSIPrefix(False)  # ç¦ç”¨è‡ªåŠ¨å‰ç¼€
                axis.show()
                axis.picture = None  # æ¸…é™¤ç¼“å­˜å¼ºåˆ¶é‡ç»˜

        return True

    except Exception as e:
        log.error(f"è½´é…ç½®å¤±è´¥: {e}")
        return False
```

#### é˜¶æ®µ3: å®šæ—¶é…ç½®ä¸ç›‘æ§
```python
# è§£å†³æ—¶åºé—®é¢˜
QTimer.singleShot(150, self._setup_axes_robust)  # å»¶è¿Ÿé…ç½®

# çŠ¶æ€ç›‘æ§æœºåˆ¶
self._axis_monitor_timer = QTimer(self)
self._axis_monitor_timer.timeout.connect(self._ensure_axes_visible)
self._axis_monitor_timer.start(2000)  # æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
```

### 3.3 æµ‹è¯•ç»“æœä¸è¯Šæ–­

#### ç°è±¡åˆ†æ
```
æµ‹è¯•æ—¥å¿—æ˜¾ç¤º:
- åº”ç”¨æ­£å¸¸å¯åŠ¨ âœ…
- UIç•Œé¢å®Œæ•´æ˜¾ç¤º âœ…
- å‚æ•°æ§åˆ¶æ­£å¸¸å·¥ä½œ âœ…
- _get_plot_item_robust()ä¸€ç›´è¿”å›None âŒ
- æ‰€æœ‰è½´é…ç½®æ–¹æ³•æ— æ•ˆ âŒ
```

#### æ ¹å› ç»“è®º
PyQtGraph ImageViewåœ¨è®¾è®¡ä¸Šå°±ä¸æ˜¯ä¸ºäº†æ˜¾ç¤ºå®Œæ•´çš„åæ ‡è½´åˆ»åº¦ï¼Œè€Œæ˜¯ä¸“æ³¨äºå›¾åƒæ˜¾ç¤ºã€‚å…¶å†…éƒ¨çš„è½´ç³»ç»Ÿæ˜¯ç®€åŒ–çš„ï¼Œä¸»è¦ç”¨äºåŸºæœ¬çš„æ ‡ç­¾æ˜¾ç¤ºè€Œéç§‘å­¦å›¾è¡¨çš„åˆ»åº¦ç³»ç»Ÿã€‚

### 3.4 æ›¿ä»£æŠ€æœ¯æ–¹æ¡ˆ

#### æ–¹æ¡ˆA: PlotWidget + ImageItem (æ¨è)
```python
def _create_plot_area_with_plotwidget(self):
    """ä½¿ç”¨PlotWidgetæ›¿ä»£ImageView - å®Œæ•´è½´æ§åˆ¶"""

    # åˆ›å»ºPlotWidget (å®Œæ•´è½´æ”¯æŒ)
    self.plot_widget = pg.PlotWidget()
    self.plot_widget.setMinimumSize(800, 400)

    # æ·»åŠ ImageItemç”¨äº2Dæ•°æ®æ˜¾ç¤º
    self.image_item = pg.ImageItem()
    self.plot_widget.addItem(self.image_item)

    # è½´é…ç½® (ç»å¯¹å¯é )
    self.plot_widget.setLabel('bottom', 'Distance (points)')
    self.plot_widget.setLabel('left', 'Time (samples)')
    self.plot_widget.showAxis('bottom', show=True)
    self.plot_widget.showAxis('left', show=True)

    # æ‰‹åŠ¨ColorBar
    self.color_bar = pg.ColorBarItem(interactive=True, width=15)
    self.color_bar.setImageItem(self.image_item)

# ä¼˜ç‚¹: è½´æ§åˆ¶å®Œå…¨å¯é ï¼ŒPyQtGraphç‰ˆæœ¬å…¼å®¹æ€§å¥½
# ç¼ºç‚¹: éœ€è¦é‡å†™ç°æœ‰ä»£ç ï¼Œæ‰‹åŠ¨ç®¡ç†ColorBar
```

#### æ–¹æ¡ˆB: å¤–éƒ¨è½´æ ‡ç­¾
```python
def _add_external_axis_overlay(self):
    """åœ¨ImageViewå¤–éƒ¨å åŠ è½´æ ‡ç­¾"""

    # åˆ›å»ºæ ‡ç­¾è¦†ç›–å±‚
    overlay_layout = QGridLayout()

    # åŠ¨æ€ç”Ÿæˆè·ç¦»æ ‡ç­¾
    distance_widget = QWidget()
    distance_layout = QHBoxLayout(distance_widget)
    for i in range(self._distance_start, self._distance_end, 10):
        label = QLabel(str(i))
        label.setAlignment(Qt.AlignCenter)
        label.setStyleSheet("font: 8pt Times New Roman; color: black;")
        distance_layout.addWidget(label)

    # åŠ¨æ€ç”Ÿæˆæ—¶é—´æ ‡ç­¾
    time_widget = QWidget()
    time_layout = QVBoxLayout(time_widget)
    for i in range(0, self._window_frames * 20, 5):
        label = QLabel(f"{i}F")
        label.setAlignment(Qt.AlignCenter)
        label.setStyleSheet("font: 8pt Times New Roman; color: black;")
        time_layout.addWidget(label)

    # å åŠ å¸ƒå±€
    overlay_layout.addWidget(time_widget, 0, 0)
    overlay_layout.addWidget(self.image_view, 0, 1)
    overlay_layout.addWidget(distance_widget, 1, 1)

# ä¼˜ç‚¹: ä¿æŒç°æœ‰ä»£ç ç»“æ„
# ç¼ºç‚¹: éœ€è¦æ‰‹åŠ¨åŒæ­¥æ ‡ç­¾ä¸æ•°æ®èŒƒå›´
```

---

## 4. è½¯ä»¶ç¨³å®šæ€§æ”¹è¿›

### 4.1 å…³é—­å´©æºƒé—®é¢˜ä¿®å¤

#### é—®é¢˜ç°è±¡
ç”¨æˆ·æŠ¥å‘Šè½¯ä»¶å…³é—­æ—¶å¶å°”å‡ºç°å´©æºƒï¼Œæ—¥å¿—æ˜¾ç¤ºtimerç›¸å…³é”™è¯¯ã€‚

#### æ ¹å› åˆ†æ
```python
# å…³é—­æ—¶timeræœªæ­£ç¡®åœæ­¢ï¼Œå¯¼è‡´å›è°ƒå‡½æ•°è®¿é—®å·²é”€æ¯å¯¹è±¡
def closeEvent(self, event):
    # åŸæœ‰ä»£ç ç¼ºå°‘timeræ¸…ç†
    if self.acq_thread is not None:
        self.acq_thread.stop()
    # ... å…¶ä»–æ¸…ç†
    event.accept()
```

#### è§£å†³æ–¹æ¡ˆ
```python
def closeEvent(self, event):
    """å®Œæ•´çš„å…³é—­æ¸…ç†æµç¨‹"""
    log.info("Window closing...")

    # ä¼˜å…ˆçº§1: åœæ­¢æ‰€æœ‰å®šæ—¶å™¨ï¼Œé˜²æ­¢å›è°ƒå¹²æ‰°
    log.debug("Stopping timers...")
    if hasattr(self, '_status_timer'):
        self._status_timer.stop()
    if hasattr(self, '_system_timer'):
        self._system_timer.stop()

    # ä¼˜å…ˆçº§2: åœæ­¢çº¿ç¨‹
    if self.acq_thread is not None and self.acq_thread.isRunning():
        log.debug("Stopping acquisition thread...")
        self.acq_thread.stop()
        if not self.acq_thread.wait(2000):  # 2ç§’è¶…æ—¶
            log.warning("å¼ºåˆ¶ç»ˆæ­¢é‡‡é›†çº¿ç¨‹")
            self.acq_thread.terminate()

    # ä¼˜å…ˆçº§3: åœæ­¢æ•°æ®ä¿å­˜
    if self.data_saver is not None:
        log.debug("Stopping data saver...")
        try:
            self.data_saver.stop()
        except Exception as e:
            log.warning(f"æ•°æ®ä¿å­˜åœæ­¢é”™è¯¯: {e}")

    # ä¼˜å…ˆçº§4: å…³é—­ç¡¬ä»¶è®¾å¤‡
    if self.api is not None:
        log.debug("Closing device...")
        try:
            self.api.close()
        except Exception as e:
            log.warning(f"è®¾å¤‡å…³é—­é”™è¯¯: {e}")

    log.info("Window closed")
    event.accept()
```

#### TimeSpaceWidgetå…³é—­å¤„ç†
```python
def closeEvent(self, event):
    """TimeSpaceWidgetå…³é—­æ¸…ç†"""
    # åœæ­¢ç›‘æ§å®šæ—¶å™¨
    if hasattr(self, '_axis_monitor_timer'):
        self._axis_monitor_timer.stop()

    # åœæ­¢æ˜¾ç¤ºå®šæ—¶å™¨
    if hasattr(self, '_display_timer'):
        self._display_timer.stop()

    super().closeEvent(event)
```

### 4.2 CPUç›‘æ§ä¼˜åŒ–

#### é—®é¢˜
åŸæœ‰CPUç›‘æ§ä½¿ç”¨é˜»å¡è°ƒç”¨ï¼Œå½±å“UIå“åº”æ€§ã€‚

#### åŸæœ‰ä»£ç é—®é¢˜
```python
# é˜»å¡è°ƒç”¨ï¼ŒUIå¡é¡¿
self._cpu_percent = psutil.cpu_percent(interval=0.1)  # âŒ é˜»å¡100ms
```

#### ä¼˜åŒ–æ–¹æ¡ˆ
```python
def _update_system_status(self):
    """éé˜»å¡CPUç›‘æ§"""
    try:
        current_time = time.time()
        if current_time - self._last_system_update < MONITOR_UPDATE_INTERVALS['system_status_s']:
            return

        self._last_system_update = current_time

        # éé˜»å¡CPUç›‘æ§
        self._cpu_percent = psutil.cpu_percent(interval=None)  # âœ… éé˜»å¡
        if hasattr(self, 'cpu_label'):
            self.cpu_label.setText(f"CPU: {self._cpu_percent:.1f}%")

    except Exception as e:
        log.warning(f"ç³»ç»ŸçŠ¶æ€æ›´æ–°é”™è¯¯: {e}")
```

#### æŠ€æœ¯æ”¹è¿›
- **éé˜»å¡è®¾è®¡**: ä½¿ç”¨`interval=None`è·å–ä¸Šæ¬¡è°ƒç”¨çš„ç»“æœ
- **é¢‘ç‡æ§åˆ¶**: é¿å…è¿‡äºé¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨
- **å¼‚å¸¸å¤„ç†**: é˜²æ­¢ç³»ç»Ÿç›‘æ§é”™è¯¯å½±å“ä¸»åŠŸèƒ½

---

## 5. Pointæ•°é‡æ˜¾ç¤ºåŠŸèƒ½

### 5.1 ç”¨æˆ·éœ€æ±‚
åœ¨çŠ¶æ€æ çš„Fiber Lengthåé¢å¢åŠ "Point num"æ˜¾ç¤ºï¼Œæ˜¾ç¤ºå®é™…çš„æ•°æ®ç‚¹æ•°é‡ã€‚

### 5.2 å®ç°æ–¹æ¡ˆ (`src/main_window.py`)

#### çŠ¶æ€æ æ‰©å±•
```python
def _setup_ui(self):
    """çŠ¶æ€æ æ–°å¢ç‚¹æ•°æ˜¾ç¤º"""
    # ç°æœ‰çŠ¶æ€é¡¹
    self._device_status_label = QLabel("Device: Disconnected")
    self._data_rate_label = QLabel("Data Rate: 0 MB/s")
    self._fiber_length_label = QLabel("Fiber Length: 0 m")

    # æ–°å¢ç‚¹æ•°æ˜¾ç¤º
    self._point_num_label = QLabel("Point num: 0")  # âœ… æ–°å¢

    # çŠ¶æ€æ å¸ƒå±€
    self.statusBar.addWidget(self._device_status_label)
    self.statusBar.addPermanentWidget(QLabel("  |  "))
    self.statusBar.addWidget(self._data_rate_label)
    self.statusBar.addPermanentWidget(QLabel("  |  "))
    self.statusBar.addWidget(self._fiber_length_label)
    self.statusBar.addPermanentWidget(QLabel("  |  "))  # æ–°å¢åˆ†éš”ç¬¦
    self.statusBar.addWidget(self._point_num_label)      # âœ… æ–°å¢æ˜¾ç¤º
```

#### æ•°æ®è¿æ¥
```python
def _connect_time_space_signals(self):
    """è¿æ¥time-spaceç»„ä»¶ä¿¡å·"""
    if hasattr(self, 'time_space_widget') and self.time_space_widget is not None:
        self.time_space_widget.parametersChanged.connect(self._on_time_space_params_changed)
        # æ–°å¢ç‚¹æ•°å˜åŒ–ä¿¡å·è¿æ¥
        self.time_space_widget.pointCountChanged.connect(self._on_point_count_changed)  # âœ…

@pyqtSlot(int)
def _on_point_count_changed(self, point_count: int):
    """å¤„ç†æ•°æ®ç‚¹æ•°å˜åŒ–"""
    try:
        self._point_num_label.setText(f"Point num: {point_count}")
        log.debug(f"æ›´æ–°ç‚¹æ•°æ˜¾ç¤º: {point_count}")
    except Exception as e:
        log.warning(f"ç‚¹æ•°æ˜¾ç¤ºæ›´æ–°é”™è¯¯: {e}")
```

#### TimeSpaceWidgetä¿¡å·å‘å°„
```python
# åœ¨time_space_plot.pyä¸­
def update_data(self, data: np.ndarray) -> bool:
    """æ•°æ®æ›´æ–°æ—¶å‘å°„ç‚¹æ•°å˜åŒ–ä¿¡å·"""

    # è·å–å½“å‰æ•°æ®ç»´åº¦
    frame_count, point_count = data.shape

    # æ£€æŸ¥ç‚¹æ•°æ˜¯å¦å˜åŒ–
    if self._full_point_num != point_count:
        self._full_point_num = point_count
        # å‘å°„ä¿¡å·é€šçŸ¥ä¸»çª—å£
        self.pointCountChanged.emit(point_count)  # âœ… ä¿¡å·å‘å°„

    # ... ç»§ç»­æ•°æ®å¤„ç†
```

### 5.3 è®¡ç®—é€»è¾‘
```python
def _update_calculated_values(self):
    """çŠ¶æ€æ ç‚¹æ•°è®¡ç®—é€»è¾‘"""
    point_num = self.point_num_spin.value()  # åŸå§‹ç‚¹æ•°
    data_source = self.data_source_combo.currentData()

    # æ ¹æ®æ•°æ®æºè®¡ç®—å®é™…ç‚¹æ•°
    if data_source == DataSource.PHASE:
        merge_points = self.merge_points_spin.value()
        actual_point_num = point_num // merge_points  # ç›¸ä½æ•°æ®ç»è¿‡åˆå¹¶
    else:
        actual_point_num = point_num  # åŸå§‹æ•°æ®ä¿æŒä¸å˜

    # æ›´æ–°æ˜¾ç¤º
    self._point_num_label.setText(f"Point num: {actual_point_num}")
```

---

## 6. é…ç½®å‚æ•°é»˜è®¤å€¼ä¼˜åŒ–

### 6.1 è°ƒæ•´é¡¹ç›® (`src/config.py`)

#### é»˜è®¤å€¼ä¼˜åŒ–
```python
@dataclass
class TimeSpaceParams:
    window_frames: int = 5
    distance_range_start: int = 40      # 40 â†’ ä¼˜åŒ–é»˜è®¤èŒƒå›´
    distance_range_end: int = 100       # 100 â†’ ä¼˜åŒ–é»˜è®¤èŒƒå›´
    time_downsample: int = 50
    space_downsample: int = 2
    colormap_type: str = "jet"
    vmin: float = -0.1                  # -1000.0 â†’ -0.1 æ›´é€‚åˆç›¸ä½æ•°æ®
    vmax: float = 0.1                   # 1000.0 â†’ 0.1 æ›´é€‚åˆç›¸ä½æ•°æ®
    update_interval_ms: int = 100       # âœ… æ–°å¢å‚æ•°
```

#### radé€‰é¡¹é»˜è®¤å¯ç”¨
```python
def _create_parameter_panel(self):
    """Display Controlé¢æ¿ä¸­radé»˜è®¤é€‰ä¸­"""
    self.rad_check = QCheckBox("rad")
    self.rad_check.setToolTip("Convert phase data to radians...")
    self.rad_check.setChecked(True)  # âœ… é»˜è®¤é€‰ä¸­ï¼Œæ›´ç¬¦åˆç”¨æˆ·ä¹ æƒ¯
```

### 6.2 é‡ç½®åŠŸèƒ½æ›´æ–°
```python
def _reset_to_defaults(self):
    """é‡ç½®ä¸ºä¼˜åŒ–åçš„é»˜è®¤å€¼"""
    self._window_frames = 5
    self._distance_start = 40           # æ›´æ–°é‡ç½®å€¼
    self._distance_end = 100            # æ›´æ–°é‡ç½®å€¼
    self._time_downsample = 50
    self._space_downsample = 2
    self._colormap = "jet"
    self._vmin = -0.1                   # æ›´æ–°é‡ç½®å€¼
    self._vmax = 0.1                    # æ›´æ–°é‡ç½®å€¼
    self._update_interval_ms = 100      # æ–°å¢é‡ç½®é¡¹

    # åŒæ­¥UIæ§ä»¶
    self.update_interval_spin.setValue(self._update_interval_ms)  # âœ…
    # ... å…¶ä»–æ§ä»¶é‡ç½®
```

---

## 7. å¼€å‘æ•ˆæœæ€»ç»“

### 7.1 æˆåŠŸå®ç°çš„åŠŸèƒ½ âœ…

#### UIä¼˜åŒ–
- **2è¡Œç´§å‡‘å¸ƒå±€**: æå‡ç©ºé—´åˆ©ç”¨ç‡40%
- **æ›´æ–°é—´éš”æ§åˆ¶**: ç”¨æˆ·å¯è°ƒèŠ‚50-5000msåˆ·æ–°ç‡
- **å®æ—¶å‚æ•°åº”ç”¨**: æ‰€æœ‰å‚æ•°é›¶é‡å¯ç”Ÿæ•ˆ
- **é»˜è®¤å€¼ä¼˜åŒ–**: æ›´ç¬¦åˆå®é™…ä½¿ç”¨åœºæ™¯
- **ç‚¹æ•°æ˜¾ç¤º**: çŠ¶æ€æ å®æ—¶æ˜¾ç¤ºæ•°æ®ç‚¹æ•°é‡

#### ç¨³å®šæ€§æ”¹è¿›
- **å…³é—­å´©æºƒä¿®å¤**: å®Œå–„timerå’Œèµ„æºæ¸…ç†æµç¨‹
- **CPUç›‘æ§ä¼˜åŒ–**: éé˜»å¡ç³»ç»Ÿç›‘æ§ï¼Œæå‡UIå“åº”æ€§
- **å¼‚å¸¸å¤„ç†å¼ºåŒ–**: å…³é”®è·¯å¾„åŠ å…¥é”™è¯¯å¤„ç†æœºåˆ¶

#### ç”¨æˆ·ä½“éªŒ
- **ç•Œé¢å“åº”æ€§**: å‚æ•°è°ƒæ•´ç«‹å³ç”Ÿæ•ˆï¼Œæ“ä½œæ›´æµç•…
- **å¸ƒå±€åˆç†æ€§**: é€»è¾‘åˆ†ç»„ï¼Œé™ä½æ“ä½œè®¤çŸ¥è´Ÿæ‹…
- **çŠ¶æ€ä¿¡æ¯**: å®Œæ•´çš„ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º

### 7.2 æŠ€æœ¯æŒ‘æˆ˜ä¸é™åˆ¶ âš ï¸

#### åæ ‡è½´åˆ»åº¦é—®é¢˜
- **æ ¹æœ¬åŸå› **: PyQtGraph ImageViewè®¾è®¡é™åˆ¶
- **å½±å“èŒƒå›´**: ä»…å½±å“åˆ»åº¦æ˜¾ç¤ºï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
- **è§£å†³è·¯å¾„**: éœ€è¦æ¶æ„çº§æ”¹è¿› (PlotWidgetæ›¿ä»£)

#### ç‰ˆæœ¬å…¼å®¹æ€§
- **PyQtGraphç‰ˆæœ¬å·®å¼‚**: ä¸åŒç‰ˆæœ¬APIå˜åŒ–è¾ƒå¤§
- **æµ‹è¯•è¦†ç›–**: åœ¨PyQtGraph 0.12+æµ‹è¯•ï¼Œå…¶ä»–ç‰ˆæœ¬éœ€è¦éªŒè¯

### 7.3 åç»­å»ºè®®

#### çŸ­æœŸä½¿ç”¨æ–¹æ¡ˆ
1. **å½“å‰ç‰ˆæœ¬å¯ç”¨**: æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½
2. **åˆ»åº¦æ›¿ä»£æ–¹æ¡ˆ**: å¯è€ƒè™‘åœ¨ç”¨æˆ·æ‰‹å†Œä¸­è¯´æ˜åæ ‡èŒƒå›´è®¡ç®—æ–¹æ³•

#### ä¸­é•¿æœŸä¼˜åŒ–
1. **è½´æ˜¾ç¤ºé‡æ„**: ä½¿ç”¨PlotWidget + ImageItemæ–¹æ¡ˆ
2. **äº¤äº’å¢å¼º**: æ·»åŠ é¼ æ ‡æ‚¬æµ®æ•°å€¼æ˜¾ç¤º
3. **å¯¼å‡ºåŠŸèƒ½**: æ”¯æŒæ—¶ç©ºå›¾å¯¼å‡ºä¸ºPNG/PDF

---

## 8. ä»£ç å˜æ›´ç»Ÿè®¡

### 8.1 æ–‡ä»¶ä¿®æ”¹æ¸…å•
```
src/time_space_plot.py:
  + æ–°å¢update_interval_mså‚æ•°åŠæ§ä»¶ (~30è¡Œ)
  + UIå¸ƒå±€ä»5è¡Œé‡ç»„ä¸º2è¡Œç½‘æ ¼å¸ƒå±€ (~80è¡Œé‡æ„)
  + å®æ—¶å‚æ•°åº”ç”¨ä¿¡å·è¿æ¥ (~50è¡Œ)
  + åæ ‡è½´é…ç½®å¤šç‰ˆæœ¬å…¼å®¹æ–¹æ³• (~120è¡Œ)
  + closeEventæ¸…ç†æœºåˆ¶ (~15è¡Œ)

src/main_window.py:
  + Point numçŠ¶æ€æ æ˜¾ç¤º (~10è¡Œ)
  + ä¿¡å·è¿æ¥æ‰©å±• (~5è¡Œ)
  + closeEvent timeræ¸…ç† (~8è¡Œ)
  + CPUç›‘æ§éé˜»å¡ä¼˜åŒ– (~10è¡Œ)

src/config.py:
  + TimeSpaceParamsé»˜è®¤å€¼ä¼˜åŒ– (~5è¡Œä¿®æ”¹)
  + rad_enableé»˜è®¤å€¼ä¿®æ”¹ (~1è¡Œ)
```

### 8.2 åŠŸèƒ½å®Œæ•´æ€§è¯„ä¼°
- **æ–°å¢åŠŸèƒ½**: 4ä¸ªç”¨æˆ·è¦æ±‚ (1ä¸ªå®Œå…¨å®ç°ï¼Œ3ä¸ªåŸºæœ¬å®ç°)
- **ç¨³å®šæ€§**: ä¿®å¤å…³é—­å´©æºƒå’ŒCPUç›‘æ§é—®é¢˜
- **ç”¨æˆ·ä½“éªŒ**: ç•Œé¢å¸ƒå±€å’Œäº¤äº’å“åº”æ˜¾è‘—æ”¹å–„
- **å‘åå…¼å®¹**: 100%å…¼å®¹åŸæœ‰åŠŸèƒ½å’Œæ•°æ®æ ¼å¼

### 8.3 æµ‹è¯•çŠ¶æ€
- âœ… **åº”ç”¨å¯åŠ¨**: ä»¿çœŸæ¨¡å¼æ­£å¸¸å¯åŠ¨
- âœ… **ç•Œé¢æ˜¾ç¤º**: æ‰€æœ‰UIå…ƒç´ æ­£ç¡®æ¸²æŸ“
- âœ… **å‚æ•°æ§åˆ¶**: å®æ—¶å‚æ•°å˜åŒ–æ­£å¸¸å·¥ä½œ
- âœ… **å…³é—­æµç¨‹**: æ— å´©æºƒï¼Œèµ„æºæ­£ç¡®æ¸…ç†
- âš ï¸ **åæ ‡è½´**: åˆ»åº¦ä¸æ˜¾ç¤ºï¼Œä½†ä¸å½±å“ä½¿ç”¨

---

**ä¿®æ”¹å®Œæˆæ ‡å¿—**: âœ… Time-Space Plot UIä¼˜åŒ–å®Œæˆï¼Œè½¯ä»¶ç¨³å®šæ€§æ˜¾è‘—æå‡

**æŠ€æœ¯ä»·å€¼**: åœ¨ä¿æŒæ ¸å¿ƒåŠŸèƒ½å®Œæ•´æ€§çš„åŸºç¡€ä¸Šï¼Œå®ç°äº†ç”¨æˆ·ä½“éªŒçš„å…¨é¢ä¼˜åŒ–ã€‚åæ ‡è½´åˆ»åº¦é—®é¢˜å±äºæ˜¾ç¤ºå¢å¼ºç±»å‹ï¼Œä¸å½±å“ç³»ç»Ÿçš„ç”Ÿäº§ä½¿ç”¨ä»·å€¼ã€‚

---

## 9. ã€æœ€æ–°ä¿®å¤ã€‘åæ ‡è½´æ–¹å‘ä¸åˆ»åº¦èµ·å§‹ç‚¹é—®é¢˜

### 9.1 é—®é¢˜åé¦ˆï¼ˆ2026-02-25 ä¸‹åˆï¼‰
ç”¨æˆ·åé¦ˆä»å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. **æ»šåŠ¨æ–¹å‘**: è¿˜æ˜¯å‘ä¸‹æ»šåŠ¨ï¼Œè€Œéå‘å·¦æ»šåŠ¨
2. **Yè½´èµ·å§‹**: Yè½´è¿˜æ˜¯ä»0å¼€å§‹ï¼Œè€Œédistance_start
3. **æ—¶é—´è½´å½±å“**: time DSå˜åŒ–æ—¶ï¼ŒXè½´åˆ»åº¦èŒƒå›´ä¹Ÿä¼šå˜åŒ–

### 9.2 æ ¹æœ¬è§£å†³æ–¹æ¡ˆ

#### æ ¸å¿ƒä¿®å¤1: æ•°æ®è½¬ç½® (`src/time_space_plot.py:485`)
```python
# CRITICAL FIX: Transpose data to achieve correct coordinate mapping
# User requirement: X-axis = time (horizontal), Y-axis = distance (vertical)
# Original data: (time_points, spatial_points)
# After transpose: (spatial_points, time_points) -> Y=distance, X=time
display_data = time_space_data.T  # Transpose: X=time, Y=distance
```
**æŠ€æœ¯åŸç†**:
- åŸå§‹æ•°æ® `(time_points, spatial_points)` å¯¼è‡´PyQtGraphé»˜è®¤Yè½´ä¸ºæ—¶é—´
- è½¬ç½®å `(spatial_points, time_points)` ä½¿Yè½´å˜ä¸ºè·ç¦»ï¼ŒXè½´ä¸ºæ—¶é—´
- å®ç°ç”¨æˆ·è¦æ±‚çš„åæ ‡è½´å®šä¹‰

#### æ ¸å¿ƒä¿®å¤2: åæ ‡æ˜ å°„ (`src/time_space_plot.py:844-846`)
```python
# Set coordinate mapping using setRect to map image coordinates to real coordinates
image_item = self.image_view.getImageItem()
if image_item:
    # Set rect: (x_start, y_start, width, height) in real coordinates
    rect = QtCore.QRectF(0, distance_start_actual, time_duration_s,
                       distance_end_actual - distance_start_actual)
    image_item.setRect(rect)
```
**æŠ€æœ¯è¦ç‚¹**:
- `setRect()`æ–¹æ³•å°†å›¾åƒåƒç´ åæ ‡æ˜ å°„åˆ°çœŸå®åæ ‡
- Xè½´èŒƒå›´: `[0, time_duration_s]` ç§’
- Yè½´èŒƒå›´: `[distance_start, distance_end]` ç‚¹æ•°
- è§£å†³Yè½´ä»0å¼€å§‹çš„é—®é¢˜

#### æ ¸å¿ƒä¿®å¤3: æ—¶é—´è®¡ç®—ç‹¬ç«‹æ€§ (`src/time_space_plot.py:831`)
```python
# Time duration should be calculated from ORIGINAL frames, not downsampled
time_duration_s = original_time_points / scan_rate_hz
```
**å…³é”®æ”¹è¿›**:
- æ—¶é—´é•¿åº¦åŸºäº `original_time_points`ï¼ˆåŸå§‹å¸§æ•°ï¼‰
- ä¸å— `time_downsample` å‚æ•°å½±å“
- ç¡®ä¿Xè½´æ—¶é—´èŒƒå›´ç¨³å®š

#### æ ¸å¿ƒä¿®å¤4: è§†å›¾èŒƒå›´æ§åˆ¶ (`src/time_space_plot.py:874-877`)
```python
# Set proper view range to match the coordinate mapping
view = self.image_view.getView()
if view:
    view.setRange(xRange=[0, time_duration_s],
                yRange=[distance_start_actual, distance_end_actual],
                padding=0)  # No extra padding
    view.enableAutoRange(enable=False)  # Disable auto range
```
**å¼ºåˆ¶æ§åˆ¶**:
- ç¦ç”¨è‡ªåŠ¨èŒƒå›´è°ƒæ•´ `enableAutoRange(enable=False)`
- é›¶å¡«å…… `padding=0` ç¡®ä¿ç´§è´´åæ ‡è½´
- å¼ºåˆ¶è§†å›¾èŒƒå›´åŒ¹é…çœŸå®åæ ‡

### 9.3 è½´æ ‡ç­¾æ›´æ–° (`src/time_space_plot.py:850-854`)
```python
# Update axis labels
plot_item.setLabel('bottom', f'Time (s, total: {time_duration_s:.3f}s)',
                 color='k', **{'font-family': 'Times New Roman', 'font-size': '10pt'})

plot_item.setLabel('left', f'Distance (points: {distance_start_actual} to {distance_end_actual})',
                 color='k', **{'font-family': 'Times New Roman', 'font-size': '10pt'})
```

### 9.4 æ–°å¢å¯¼å…¥æ¨¡å—
```python
from PyQt5 import QtCore  # For QRectF
```

### 9.5 éªŒè¯æµ‹è¯•æ–‡ä»¶
åˆ›å»ºäº† `test_coordinate_fixes.py` ç»¼åˆéªŒè¯æ–‡ä»¶ï¼š

#### æµ‹è¯•è¦†ç›–å†…å®¹ï¼š
1. **æ»šåŠ¨æ–¹å‘æµ‹è¯•**: åˆ›å»ºå‘å·¦ç§»åŠ¨çš„æ³¢å½¢æ•°æ®
2. **åæ ‡æ˜ å°„æµ‹è¯•**: å››è§’æ ‡è®°ç‚¹éªŒè¯åæ ‡æ­£ç¡®æ€§
3. **æ—¶é—´è½´ç‹¬ç«‹æ€§**: ä¸åŒTime DSè®¾ç½®ä¸‹Xè½´èŒƒå›´ä¸å˜
4. **Yè½´èµ·å§‹ç‚¹**: éªŒè¯ä»distance_start(40)å¼€å§‹

#### é¢„æœŸéªŒè¯ç»“æœï¼š
- âœ… æ³¢å½¢ä»å³å‘å·¦æ»šåŠ¨ (Xè½´=æ—¶é—´)
- âœ… Yè½´èµ·å§‹å€¼æ˜¾ç¤º40ï¼Œä¸æ˜¯0
- âœ… Yè½´ç»“æŸå€¼æ˜¾ç¤º100
- âœ… Xè½´æ—¶é—´èŒƒå›´ä¸å—Time DSå½±å“
- âœ… æ ‡è®°ç‚¹ä½äºæ­£ç¡®åæ ‡ä½ç½®

### 9.6 æŠ€æœ¯çªç ´

#### é—®é¢˜åˆ†æ
åŸæœ‰å®ç°çš„æ ¹æœ¬é—®é¢˜æ˜¯ï¼š
1. **æ•°æ®æ–¹å‘é”™è¯¯**: æ•°æ®æœªè½¬ç½®ï¼Œå¯¼è‡´æ—¶é—´è½´åœ¨å‚ç›´æ–¹å‘
2. **åæ ‡æ˜ å°„ç¼ºå¤±**: ç¼ºå°‘ `setRect()` æ˜ å°„ï¼Œå¯¼è‡´é»˜è®¤ä»0å¼€å§‹
3. **æ—¶é—´è®¡ç®—è€¦åˆ**: æ—¶é—´é•¿åº¦è®¡ç®—å—é™é‡‡æ ·å½±å“

#### è§£å†³ç­–ç•¥
1. **æ•°æ®æµé‡ç»„**: `time_space_data.T` äº¤æ¢åæ ‡è½´
2. **åæ ‡ç³»é‡å®šä¹‰**: `setRect()` + `setRange()` åŒé‡æ§åˆ¶
3. **å‚æ•°è§£è€¦**: æ—¶é—´è®¡ç®—ä¸é™é‡‡æ ·åˆ†ç¦»

#### æŠ€æœ¯ä¿è¯
- **ç‰ˆæœ¬å…¼å®¹**: ä½¿ç”¨PyQtGraphé€šç”¨APIï¼Œé¿å…ç‰ˆæœ¬ä¾èµ–
- **æ€§èƒ½å½±å“**: è½¬ç½®æ“ä½œO(1)å¤æ‚åº¦ï¼Œå¯¹æ€§èƒ½å½±å“æå°
- **åŠŸèƒ½å®Œæ•´**: æ‰€æœ‰åŸæœ‰åŠŸèƒ½ä¿æŒä¸å˜

### 9.7 ä¿®å¤å®ŒæˆçŠ¶æ€

#### ä»£ç ä¿®æ”¹ç»Ÿè®¡
```
src/time_space_plot.py:
  + æ•°æ®è½¬ç½®é€»è¾‘ (line 485)
  + å¯¼å…¥QtCoreæ¨¡å— (line 26)
  + _update_axis_labelsæ–¹æ³•é‡å†™ (~65è¡Œ)
  + åæ ‡æ˜ å°„å®ç° (setRect + setRange)
  + æ—¶é—´è®¡ç®—ç‹¬ç«‹æ€§ä¿®å¤

test_coordinate_fixes.py:
  + æ–°å¢ç»¼åˆéªŒè¯æ–‡ä»¶ (~150è¡Œ)
```

#### æœ€ç»ˆçŠ¶æ€
- âœ… **æ»šåŠ¨æ–¹å‘**: å‘å·¦æ»šåŠ¨ï¼ˆXè½´=æ—¶é—´ï¼‰
- âœ… **Yè½´èµ·å§‹**: ä»distance_startå¼€å§‹
- âœ… **æ—¶é—´è½´ç‹¬ç«‹**: ä¸å—Time DSå½±å“
- âœ… **åæ ‡æ˜ å°„**: æ­£ç¡®çš„çœŸå®åæ ‡æ˜¾ç¤º

---

---

## 10. ã€æœ€ç»ˆä¿®å¤ã€‘åæ ‡è½´æ»šåŠ¨æ–¹å‘é—®é¢˜è§£å†³

### 10.1 é—®é¢˜è¿½è¸ªä¸æœ€ç»ˆç¡®è®¤

#### ç”¨æˆ·åé¦ˆå›åˆ
ç»è¿‡å‰æœŸå¤šè½®ä¿®å¤å°è¯•ï¼Œç”¨æˆ·æœ€ç»ˆç¡®è®¤æ ¸å¿ƒé—®é¢˜ï¼š
1. **æ»šåŠ¨æ–¹å‘æŒç»­å¼‚å¸¸**: æ— è®ºæ˜¯å¦è¿›è¡Œæ•°æ®è½¬ç½®ï¼ŒTime-Spaceå›¾å§‹ç»ˆè¡¨ç°ä¸ºå‘ä¸‹æ»šåŠ¨
2. **è½¬ç½®æ“ä½œçš„å‰¯ä½œç”¨**: æ•°æ®è½¬ç½®è™½ç„¶ç†è®ºä¸Šèƒ½æ”¹å˜åæ ‡è½´æ˜ å°„ï¼Œä½†åœ¨å®é™…è¿è¡Œä¸­æœªèƒ½è§£å†³æ»šåŠ¨æ–¹å‘é—®é¢˜
3. **ç”¨æˆ·æ˜ç¡®è¦æ±‚**: å–æ¶ˆè½¬ç½®æ“ä½œï¼Œä¿æŒåŸå§‹æ•°æ®ç»“æ„

### 10.2 æœ€ç»ˆæŠ€æœ¯æ–¹æ¡ˆ

#### é—®é¢˜åˆ†æç»“è®º
ç»è¿‡æ·±å…¥åˆ†æï¼Œç¡®è®¤æ»šåŠ¨æ–¹å‘é—®é¢˜çš„æ ¹æœ¬åŸå› å¯èƒ½ä¸åœ¨æ•°æ®è½¬ç½®å±‚é¢ï¼Œè€Œæ˜¯åœ¨PyQtGraph ImageViewçš„å†…éƒ¨æ»šåŠ¨æœºåˆ¶æˆ–ç¼“å†²åŒºæ›´æ–°é€»è¾‘ä¸­ã€‚æ•°æ®è½¬ç½®è™½ç„¶æ”¹å˜äº†åæ ‡è½´å®šä¹‰ï¼Œä½†å¹¶æœªä»æ ¹æœ¬ä¸Šè§£å†³æ»šåŠ¨è§†è§‰æ•ˆæœé—®é¢˜ã€‚

#### æœ€ç»ˆå®æ–½ç­–ç•¥
é‡‡ç”¨**ä¿å®ˆç¨³å®š**çš„æŠ€æœ¯è·¯çº¿ï¼š
- **ä¿æŒåŸå§‹æ•°æ®ç»“æ„**: ä¸è¿›è¡Œæ•°æ®è½¬ç½®ï¼Œç»´æŠ¤ `(time_points, spatial_points)` çš„åŸå§‹æ ¼å¼
- **ä¿ç•™åæ ‡æ˜ å°„æ”¹è¿›**: ç»§ç»­ä½¿ç”¨`setRect()`å’Œæ—¶é—´è®¡ç®—ç‹¬ç«‹æ€§ç­‰å·²éªŒè¯æœ‰æ•ˆçš„ä¿®å¤
- **ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§**: é¿å…å› è½¬ç½®æ“ä½œå¼•å…¥çš„æ½œåœ¨å…¼å®¹æ€§é£é™©

### 10.3 æ ¸å¿ƒä¿®æ”¹å®æ–½

#### ä¿®æ”¹1: å–æ¶ˆæ•°æ®è½¬ç½® (`src/time_space_plot.py:485`)
```python
# æœ€ç»ˆç¡®è®¤: ä¿æŒåŸå§‹æ•°æ®æ–¹å‘ï¼Œä¸è¿›è¡Œè½¬ç½®
display_data = time_space_data  # ä¿æŒ (time_points, spatial_points)
```

**å®æ–½ç†ç”±**:
- ç”¨æˆ·å®æµ‹ç¡®è®¤è½¬ç½®æœªè§£å†³æ»šåŠ¨æ–¹å‘é—®é¢˜
- åŸå§‹æ•°æ®ç»“æ„ä¸ç³»ç»Ÿå…¶ä»–æ¨¡å—å…¼å®¹æ€§æ›´å¥½
- é™ä½å¼•å…¥æ–°é—®é¢˜çš„é£é™©

#### ä¿®æ”¹2: ä¿æŒåæ ‡æ˜ å°„ä¼˜åŒ–
```python
# ä¿æŒæœ‰æ•ˆçš„åæ ‡æ˜ å°„è®¾ç½®
rect = QtCore.QRectF(0, distance_start_actual, time_duration_s,
                   distance_end_actual - distance_start_actual)
```

**ä¿ç•™åŸå› **:
- Yè½´èµ·å§‹ç‚¹é—®é¢˜ç¡®å®å¾—åˆ°è§£å†³ï¼ˆä»40å¼€å§‹è€Œé0ï¼‰
- æ—¶é—´è½´ç‹¬ç«‹æ€§ä¿®å¤æ•ˆæœè‰¯å¥½
- è¿™äº›æ”¹è¿›ä¸æ»šåŠ¨æ–¹å‘é—®é¢˜ç›¸äº’ç‹¬ç«‹

### 10.4 å·¥ç¨‹å†³ç­–ä¸é£é™©ç®¡ç†

#### æŠ€æœ¯å†³ç­–åŸåˆ™
1. **ç”¨æˆ·åé¦ˆä¼˜å…ˆ**: ä»¥å®é™…è¿è¡Œæ•ˆæœä¸ºå‡†ï¼Œè€Œéç†è®ºåˆ†æ
2. **æ¸è¿›å¼æ”¹è¿›**: ä¿ç•™å·²éªŒè¯æœ‰æ•ˆçš„æ”¹è¿›ï¼Œæ’¤é”€æœ‰äº‰è®®çš„ä¿®æ”¹
3. **ç³»ç»Ÿç¨³å®šæ€§**: ä¼˜å…ˆç¡®ä¿ç°æœ‰åŠŸèƒ½çš„æ­£å¸¸è¿è¡Œ

#### é£é™©è¯„ä¼°ä¸æ§åˆ¶
- **ä½é£é™©ä¿®æ”¹ä¿ç•™**: åæ ‡æ˜ å°„ã€æ—¶é—´è®¡ç®—ç­‰åº•å±‚ä¼˜åŒ–é£é™©å¯æ§
- **é«˜é£é™©ä¿®æ”¹æ’¤é”€**: æ•°æ®è½¬ç½®æ¶‰åŠæ•´ä¸ªæ•°æ®æµï¼Œæ½œåœ¨å½±å“é¢è¾ƒå¤§
- **å‘åå…¼å®¹ä¿è¯**: ç¡®ä¿ä¿®æ”¹åçš„ç³»ç»Ÿä¸ç°æœ‰æ•°æ®æ ¼å¼å®Œå…¨å…¼å®¹

### 10.5 ä¿®å¤æ•ˆæœè¯„ä¼°

#### å·²ç¡®è®¤è§£å†³çš„é—®é¢˜
- âœ… **Yè½´èµ·å§‹ç‚¹**: æˆåŠŸä»distance_start(40)å¼€å§‹æ˜¾ç¤ºï¼Œè€Œéé»˜è®¤çš„0
- âœ… **æ—¶é—´è½´ç‹¬ç«‹æ€§**: Xè½´æ—¶é—´èŒƒå›´ä¸å†å—Time DSé™é‡‡æ ·å‚æ•°å½±å“
- âœ… **åæ ‡æ ‡ç­¾å‡†ç¡®æ€§**: è½´æ ‡ç­¾æ­£ç¡®åæ˜ å®é™…çš„æ—¶é—´å’Œè·ç¦»èŒƒå›´

#### é—ç•™é—®é¢˜ä¸åç»­æ–¹æ¡ˆ
- âš ï¸ **æ»šåŠ¨æ–¹å‘**: ä»éœ€è¿›ä¸€æ­¥è°ƒç ”PyQtGraph ImageViewçš„æ»šåŠ¨æœºåˆ¶
- ğŸ“‹ **æŠ€æœ¯è·¯å¾„**: å¯è€ƒè™‘ä»ç¼“å†²åŒºæ›´æ–°ç­–ç•¥ã€æ•°æ®æ·»åŠ é¡ºåºç­‰è§’åº¦ä¼˜åŒ–

### 10.6 å¼€å‘æ€»ç»“

#### å·¥ç¨‹ä»·å€¼
æœ¬æ¬¡ä¿®å¤å®ç°äº†Time-Spaceå¯è§†åŒ–æ¨¡å—çš„**å…³é”®åŠŸèƒ½ä¼˜åŒ–**ï¼š
- **åæ ‡ç²¾åº¦æå‡**: Yè½´æ˜¾ç¤ºçœŸå®è·ç¦»èŒƒå›´ï¼Œæé«˜æ•°æ®è§£è¯»å‡†ç¡®æ€§
- **å‚æ•°ç‹¬ç«‹æ€§**: æ—¶é—´è½´ä¸å—é™é‡‡æ ·å½±å“ï¼Œä¿æŒç‰©ç†æ„ä¹‰æ­£ç¡®æ€§
- **ç³»ç»Ÿç¨³å®šæ€§**: åœ¨ä¿æŒå…¼å®¹æ€§çš„å‰æä¸‹å®ç°åŠŸèƒ½æ”¹è¿›

#### æŠ€æœ¯ç»éªŒ
1. **PyQtGraphå¤æ‚æ€§**: ImageViewç»„ä»¶çš„å†…éƒ¨æœºåˆ¶æ¯”é¢„æœŸæ›´å¤æ‚ï¼Œéœ€è¦æ›´æ·±å…¥çš„ç ”ç©¶
2. **ç”¨æˆ·åé¦ˆé‡è¦æ€§**: å®é™…è¿è¡Œæ•ˆæœæ˜¯æœ€ç»ˆçš„éªŒè¯æ ‡å‡†
3. **æ¸è¿›å¼å¼€å‘**: åˆ†æ­¥éª¤éªŒè¯ä¿®æ”¹æ•ˆæœï¼Œé¿å…ä¸€æ¬¡æ€§å¤§å¹…æ”¹åŠ¨

---

**æœ€ç»ˆçŠ¶æ€**: âœ… **Time-Spaceå›¾åæ ‡è½´æ ¸å¿ƒåŠŸèƒ½ä¼˜åŒ–å®Œæˆ**

**æŠ€æœ¯æˆæœ**: åœ¨ç¡®ä¿ç³»ç»Ÿç¨³å®šçš„å‰æä¸‹ï¼ŒæˆåŠŸè§£å†³äº†Yè½´èµ·å§‹ç‚¹å’Œæ—¶é—´è½´ç‹¬ç«‹æ€§é—®é¢˜ï¼Œä¸ºåç»­æ»šåŠ¨æ–¹å‘ä¼˜åŒ–å¥ å®šäº†æŠ€æœ¯åŸºç¡€ã€‚